# complybeacon

**ComplyBeacon** is an observability toolkit designed to collect, normalize, and enrich compliance evidence extending OpenTelemetry (OTEL) standard.

By bridging the gap between raw policy scanner output and modern logging pipelines, it provides a unified, enriched, and auditable data stream for security and compliance analysis.

> WARNING: All components are under initial development and are **not** ready for production use.

## Components

ComplyBeacon is policy-driven observability toolkit consisting of four components:

### ProofWatch
This agent is a data normalizer. It takes output from policy scanners and transforms it into a structured OpenTelemetry log record. 
This log record is the standardized payload that will be processed by the rest of the pipeline.

The key is that the ProofWatch adds custom attributes to this log record to represent the evidence, effectively creating a custom event type that is meaningful to the downstream components.

> Attributes are defined [here](./docs/ATTRIBUTES.md)

#### Supported ProofWatch Sources

| Source | Description                                         |
|--------|-----------------------------------------------------|
| `push` | An HTTP endpoint that accepts raw evidence metadata |

Example [here](./hack/sampledata/evidence.json)

### Beacon:

This is the pipeline's host, a custom OpenTelemetry Collector distribution. Its role is to receive and process the log records generated by the ProofWatch.
Beacon is pre-configured to include the TruthBeam processor, which is the next step in the data pipeline.

### TruthBeam

This is a custom OpenTelemetry Collector processor. Its function is to enrich the log records with compliance and risk data.
As a log record flows through, the TruthBeam intercepts it, calling the Compass API. It passes the raw evidence details and policy IDs from the log record's custom attributes to Compass.
It then receives the enriched data from Compass and injects that information as new custom attributes back into the same log record.

### Compass
This is a central, stateful service that provides the enrichment data.  It uses a `gemara` model to look up and tag the evidence with additional context.
Based on the policy IDs and other details provided by the TruthBeam, Compass adds new attributes like risk, threat, and regulatory information. This makes the raw log data meaningful for security analysis and reporting.

#### Support Compass Transformers

| Transformer | Description                                |
|-------------|--------------------------------------------|
| `basic`     | Transforms to `gemara` based on attributes |

# Quick Start

```bash
# Deploy the infrastructure - grafana, loki, the custom collector, compass
podman-compose up --build

# Run proofwatch. This stand up one source type with is a simple push target with raw evidence
make build
./bin/proofwatch --config ./docs/watch.yaml --skip-tls

# Test the pipeline
curl -X POST http://localhost:8083/v1/push -H "Content-Type: application/json" -d @hack/sampledata/evidence.json
```

For additional details on the full design (planned) see [`DESIGN.md`](./docs/DESIGN.md)
